I am annoyed with complexity of google code and them deprecating aapt in favour of aapt2, so...

1. **Goal is simple**: create simple apk using only java for compilation and no d8, appt and other google tools
2. Then I could try to even get rid of java and generate needed bytecode by something like C, Python or even write a backend for tsoding's b-lang implementation
3. Ideally would be to have bunch of stb-esque libraries for converting xml -> axml, generating dalvik bytecode, generating resource files, aligning, signing
4. Don't need to implement everything, no signing or alignment if possible, just the prove of concept
5. apk should just have NativeActivity and also be able to open files with Storage Access Framework(TM)
6. **TASK FAILED** Also, would be cool to not read any google code, just documentation and some blogs
7. If i will not succseed, at least I will understand low level android shit slightly better
8. Using LLMs is forbidden

## Plan (not real plan, I still don't know what am i doing)

1. read about apk structure, what file contains what, explore simple hello world built without gradle, just with d8, appt, etc.
    - ok, [this](https://hasaber8.github.io/posts/2025/01/high-level-guide-to-android-apk-structure-compilation-and-analysis/) looks promising
    - ok, also [this](https://en.wikipedia.org/wiki/Apk_\(file_format\)#Package_contents)
    - something like [smallest possible apk](https://github.com/fractalwrench/ApkGolf) should be the first prototype
        - phew, they removed, AppCompatActivity, this is nice
        - based article, they stopped using gradle (oh wait, no they don't, but I could reproduce their build without gradle)
        - ok, let's build a simple example of simple jar using only bash and base it on [this](https://github.com/jbendtsen/tiny-android-template) modern example; [instructions](#tat-instructions)
        - ok, let's replace title for now to constant to figure out how to replace aapt2
        - ok, it will not be that easy, let's [install and use ARSCLib](#arsclib-usage)
        - ok, replaced aapt2 to convert AndroidManifest.xml to binary version wiht ARSCLib based tool (code is too complex, still need to figure out how to do it myself)
        - there some other projects that encode AndroidManifest.xml: [this one is good and small](https://github.com/apk-editor/aXML) - ok, this is not simple at all, using bunch of android stuff, keep using ARSCLib
        - rewrite with freepascal not c, hehe
        - there is [single header xml parser](https://github.com/mrvladus/xml.h), neat
        - ok, we have [python axml parser](https://github.com/androguard/androguard/blob/f96221f81287d0a7a6b8ed9bf67eacd2b272c93e/androguard/core/axml/__init__.py#L424), we could try to rewrite encoder based on this and not on deep tree of java classes like in ARSCLib
        - ok, reading code of aapt. seems to be easier then decypher how ARSCLib works with this all deep inheritance, downloading it and trying to build. [doing it here](#aapt-build)
        - to build aapt I would try to use [android-sdk-tools](https://github.com/lzhiyong/android-sdk-tools) or [android-build-tools](https://github.com/termux/android-build-tools/) or [android-tools](https://github.com/nmeum/android-tools)
2. **NO.** find out what is stored in android.jar, how could i use it with java and do i need resources.arsc from android sdk if i don't use xml files
3. **NO.** find out what the fuck is R.java? Do i need it as a separate thing, could i just generate ids myself, is this that hard?
    - ok, we probably don't need R.java at all, we could just access resources using [AssetManager](https://developer.android.com/reference/android/content/res/AssetManager#open\(java.lang.String,%20int\))
    - hm, so you need resources for android:label localisation. noted; we still need to generate R.java (now generated by link.pl) and resources.arsc for this: [docs](https://apktool.org/wiki/advanced/resources-arsc/)
4. reimplement d8. read about dex file structure if there are docs (I hope)
    - there are [docs](https://source.android.com/docs/core/runtime/dex-format)!
    - there is [dalvik opcode description](https://github.com/h0tak88r/Sec-88/blob/main/android-appsec/smali/smali-cheat-sheet.md)
    - also good thing to research is [APKEditor](https://github.com/REAndroid/APKEditor)
    - [good source](https://github.com/JesusFreke/smali/tree/master) for this
5. reimplement zipalign
6. reimplement apksigner or jarsigner
    - you [couldn't](https://developer.android.com/studio/publish/app-signing#signapp) install non signed app on device :Sadge:
7. ???
8. PROFIT

## TAT instructions

tiny-android-template usage instructions (mostly not patched)

```sh
./sdk-package-list.py
# then parse and download needed android tools
mkdir Sdk
cd Sdk

andr_sdk () {
    local link=$(sed -n "s/.*\"\(.*${1}.*\.zip\)\".*/\1/p" <../sdk-package-list.html | head -1)
    echo Downloading $link
    wget $link
}

# downloading latest sdk
andr_sdk build-tools_
andr_sdk platform-
andr_sdk platform-tools_
# for jni
andr_sdk android-ndk-
unset -f andr_sdk

ls -1 *.zip | xargs -I{} unzip {}
rm *.zip

cd ..

# update includes.pl if needed

# install JDK. for ubuntu I was using this:
sudo apt install default-jdk

./link.pl
./jni-compile.py # why do you use two scripting languages here?
keytool -genkeypair -keystore keystore.jks -keyalg RSA -keysize 2048 -validity 10000
./make.pl

# connect with adb to your phone
./run.pl
```

## ARSCLib usage

Ah fuck, there are releases on github page, so just
```
# cd altaapt or use wget flag -P altaapt
wget https://github.com/REAndroid/ARSCLib/releases/download/V1.3.8/ARSCLib-1.3.8.jar
cd altaapt
make # I don't want to use perl, will replace paths for all tools in the future, now it expects global java
java -jar ./altaapt # ARSCLib-1.3.8.jar should be in same dir as altaapt
```
NO DOCS for library :Sadge:, reading code to figure out how to convert AndroidManifest.xml to binary xml
ok, ctags are awesome
```
ctags --languages=java -R ./src
```

## aapt build
```
cd ./altaapt/
git clone https://github.com/termux/android-build-tools
./build_aapt.sh
# GOD THIS PROJECT IS AWESOME
# I had some problems while building aapt2, but I don't need it so this is ok
```

---

NO LLM/GPT USED, JUST PURE AUTISM
